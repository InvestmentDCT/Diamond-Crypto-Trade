(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{"9oVN":function(t,e,n){"use strict";var o,r,s,i,a,u,l,c,f,h,d,m,b,y,p,_,g,S,v,C,O,j,w;n.d(e,"l",function(){return r}),n.d(e,"p",function(){return f}),n.d(e,"h",function(){return h}),n.d(e,"g",function(){return d}),n.d(e,"j",function(){return m}),n.d(e,"d",function(){return b}),n.d(e,"b",function(){return y}),n.d(e,"o",function(){return p}),n.d(e,"i",function(){return _}),n.d(e,"n",function(){return g}),n.d(e,"c",function(){return S}),n.d(e,"e",function(){return v}),n.d(e,"k",function(){return C}),n.d(e,"m",function(){return O}),n.d(e,"f",function(){return j}),n.d(e,"a",function(){return w}),o=n("G4qV"),r=function(t){return t.symbolLists.lists},s=function(t){return t.isAuthenticated},i=function(t){return t.widgets},a=function(t){return t.positions},u=function(t,e){return e},l=function(t,e){return e},c=function(t,e){return e},f=Object(o.a)([i,l],function(t,e){return t[e]||{}}),h=Object(o.a)(f,function(t){return t.selectedSymbols||[]}),d=Object(o.a)(f,function(t){return t.scrollToId}),m=Object(o.a)(f,function(t){return t.sorting||null}),b=Object(o.a)(f,function(t){return t.highlightedSymbols||null}),y=Object(o.a)(f,function(t){return t.columns}),p=Object(o.a)(f,function(t){return t.options||{}}),_=Object(o.a)([p,s],function(t,e){return t.shouldDisplayPositions&&e}),g=Object(o.a)(r,function(t){return Object.values(t).filter(function(t){return void 0!==t&&!t.isHotlist})}),S=Object(o.a)([r,i,l],function(t,e,n){var o,r=e[n];return void 0===r?null:null===(o=r.listId)?null:t[o]||null}),v=Object(o.a)([f,S],function(t,e){return null===e||t.isLoading||!1}),C=Object(o.a)([r,c],function(t,e){return t[e]}),O=Object(o.a)(S,function(t){return null!==t?t.symbols:[]}),j=Object(o.a)([a,u],function(t,e){return t[e]}),w=function(t){return t.activeSymbolList}},G4qV:function(t,e,n){"use strict";function o(t,e){return t===e}n.d(e,"a",function(){return r});var r=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];return function(){var e,o,r,s,i,a,u,l;for(e=arguments.length,o=Array(e),r=0;r<e;r++)o[r]=arguments[r];return s=0,i=o.pop(),a=function(t){var e,n=Array.isArray(t[0])?t[0]:t;if(!n.every(function(t){return"function"==typeof t}))throw e=n.map(function(t){return typeof t}).join(", "),new Error("Selector creators expect all input-selectors to be functions, instead received the following types: ["+e+"]");return n}(o),u=t.apply(void 0,[function(){return s++,i.apply(null,arguments)}].concat(n)),(l=t(function(){var t,e=[],n=a.length;for(t=0;t<n;t++)e.push(a[t].apply(null,arguments));return u.apply(null,e)})).resultFunc=i,l.dependencies=a,l.recomputations=function(){return s},l.resetRecomputations=function(){return s=0},l}}(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,n=null,r=null;return function(){return function(t,e,n){var o,r;if(null===e||null===n||e.length!==n.length)return!1;for(o=e.length,r=0;r<o;r++)if(!t(e[r],n[r]))return!1;return!0}(e,n,arguments)||(r=t.apply(null,arguments)),n=arguments,r}})},
TsgZ:function(t,e,n){"use strict";var o,r,s,i,a,u,l,c,f,h,d,m;n.d(e,"a",function(){return m}),o=n("mrSG"),r=n("Eyy1"),s=n("IWXC"),i=n("8woN"),a=n("y8Ih"),u=n("fgbt"),l=n("bKsZ"),c=n("NP3r"),f=new Map,h=function(){function t(t){var e=this;this._symbolDataHandlers=new Map,this._lastSymbolData=new Map,this._fastSymbols=new Set,this._subscribedSymbols=new Set,this._subscriptionSet=new Set,this._cancelSubscriptionSet=new Set,this.getSymbolFullName=function(t){if(f.has(t))return Object(r.ensureDefined)(f.get(t));var n=new Promise(function(n){var o=e._clientId+"_SymbolFullName",r=function(s){var i=function(s){e._quoteSession.unsubscribe(o,t,r),n(s)};s&&"ok"===s.status?s.values&&s.values.pro_name&&i(s.values.pro_name):i(t)};e._quoteSession.subscribe(o,t,r)});return f.set(t,n),n},this._quoteSessionDataHandler=function(t){var n,s,f=Object(r.ensureDefined)(t.symbolname),h=t;n=function(){return Object(c.enabled)(l.ProductFeatures.IDC_AVAILABLE_DELAY)},function(t){return Object(a.isSfQuoteData)(t)||Object(u.isIDCExchange)(Object(i.getExchange)(Object(r.ensureDefined)(t.symbolname)),!0)}(t)&&!n()&&(e._unsubscribeSymbols([f]),h=Object(o.__assign)(Object(o.__assign)({},t),{status:"sf_data",values:{}})),e._lastSymbolData.set(f,h),(s=e._symbolDataHandlers.get(f))&&s(h)},this._clientId=t,this._quoteSession=Object(s.getQuoteSessionInstance)("watchlist")}return t.prototype.destroy=function(){var t=Array.from(this._subscribedSymbols);this._unsubscribeSymbols(t)},t.prototype.addFastSymbol=function(t){!this._fastSymbols.has(t)&&this._subscribedSymbols.has(t)&&(this._fastSymbols.add(t),this._quoteSession.setFastSymbols(this._clientId,Array.from(this._fastSymbols)))},t.prototype.removeFastSymbol=function(t){this._fastSymbols.has(t)&&(this._fastSymbols.delete(t),this._quoteSession.setFastSymbols(this._clientId,Array.from(this._fastSymbols)))},t.prototype.addSymbolDataHandler=function(t,e){this._symbolDataHandlers.set(t,e)},t.prototype.removeSymbolDataHandler=function(t){this._symbolDataHandlers.delete(t)},t.prototype.addToSubscriptionSet=function(t){var e=this;t.forEach(function(t){return e._subscriptionSet.add(t)})},t.prototype.clearSubscriptionSet=function(){this._subscriptionSet.clear()},t.prototype.addToCancelSubscriptionSet=function(t){var e=this;t.forEach(function(t){return e._cancelSubscriptionSet.add(t)})},t.prototype.commitSubscriptionChanges=function(){var t=this,e=Array.from(this._subscriptionSet);e.forEach(function(e){t._cancelSubscriptionSet.has(e)&&(t._subscriptionSet.delete(e),t._cancelSubscriptionSet.delete(e))}),this._subscribeSymbols(Array.from(this._subscriptionSet)),this._subscriptionSet.clear(),this._unsubscribeSymbols(Array.from(this._cancelSubscriptionSet)),this._cancelSubscriptionSet.clear()},t.prototype.getLastSymbolData=function(t){return this._lastSymbolData.get(t)},t.prototype.getSymbolsFullNames=function(t){var e=this;return Promise.all(t.map(function(t){return e.getSymbolFullName(t)}))},t.prototype.getUniqueSymbolsFullNames=function(t){return this.getSymbolsFullNames(t).then(function(t){
return Array.from(new Set(t))})},t.prototype._subscribeSymbols=function(t){var e=this;this._quoteSession.subscribe(this._clientId,t,this._quoteSessionDataHandler),t.forEach(function(t){return e._subscribedSymbols.add(t)})},t.prototype._unsubscribeSymbols=function(t){var e=this;t.forEach(function(t){e._quoteSession.unsubscribe(e._clientId,t,e._quoteSessionDataHandler),e._subscribedSymbols.delete(t)})},t}(),d=function(){function t(){this._adapters={}}return t.prototype.destroy=function(){var t=this;Object.keys(this._adapters).forEach(function(e){return Object(r.ensureDefined)(t._adapters[e]).destroy()})},t.prototype.get=function(t){return void 0===this._adapters[t]&&(this._adapters[t]=new h(t)),Object(r.ensureDefined)(this._adapters[t])},t}(),m=new d},ehHn:function(t,e,n){"use strict";function o(){return g.enabled("multiple_watchlists")&&window.user&&Boolean(window.user.is_pro)}function r(t){return"string"==typeof t&&!/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/.test(t)&&!/^[\r\n\t,]*$/.test(t)}function s(t){return new S.SaveRenameDialog({title:t,fields:[new v.InputField({name:"title",label:window.t("Symbol list name")+":",maxLength:128,error:window.t("Please enter list name")})]})}function i(t){return t.replace("âˆ’","-")}function a(t,e,n,o){return Object(y.__spreadArrays)(e).sort(function(e,r){var s=C.a.get(t).getLastSymbolData(e),a=C.a.get(t).getLastSymbolData(r),u=s?s.values[n]:void 0,l=a?a.values[n]:void 0;return function(t,e){var n=-1===e?-1/0:1/0;return function(o,r){var s,a;if("rchp"!==t){if(void 0===o&&void 0===r)return 0;if(void 0===o)return-e;if(void 0===r)return e}switch(t){case"short_name":return e*(o===r?0:Object(p.ensureDefined)(o)<Object(p.ensureDefined)(r)?-1:1);case"last_price":case"change":case"rchp":case"change_percent":return s=parseFloat(i(String(o))),a=parseFloat(i(String(r))),s=isNaN(s)?n:s,a=isNaN(a)?n:a,e*(s-a);case"volume":return s=Object(p.ensureDefined)(o)>=1e100?n:Number(o),a=Object(p.ensureDefined)(r)>=1e100?n:Number(r),e*(s-a);default:return Object(p.ensureDefined)(o)>Object(p.ensureDefined)(r)?-1:1}}}(n,o)(u,l)})}function u(t,e){return t+"."+e}function l(t){return N[t]}function c(t,e){return{color:t,id:t,title:e||l(t),isHotlist:!1,type:"colored",symbols:[]}}function f(t,e){return t===e||Object(j.shortName)(t)===e}function h(t){return{symbol:t.symbol,side:t.side,qty:t.qty,avgPrice:t.avgPrice}}function d(t,e){return t===e||void 0!==t&&void 0!==e&&(t.side===e.side&&t.qty===e.qty&&t.avgPrice===e.avgPrice&&t.symbol===e.symbol)}function m(t){try{return Object(j.shortName)(t)}catch(e){return t}}function b(t){var e,n,o,r,s=new Map;for(e=0;e<t.length;e++)if(o=m(n=t[e].toUpperCase()),s.has(o)){if((r=Object(p.ensureDefined)(s.get(o))).has(n)||r.has(o)||n===o)return!0;r.add(n),s.set(o,r)}else s.set(o,new Set([n]));return!1}var y,p,_,g,S,v,C,O,j,w,L,N;n.d(e,"j",function(){return L}),n.d(e,"a",function(){return o}),n.d(e,"i",function(){return r}),n.d(e,"d",function(){return s}),n.d(e,"l",function(){return a}),n.d(e,"e",function(){return u}),n.d(e,"f",function(){return l}),n.d(e,"c",function(){return c}),
n.d(e,"b",function(){return f}),n.d(e,"m",function(){return h}),n.d(e,"h",function(){return d}),n.d(e,"k",function(){return m}),n.d(e,"g",function(){return b}),y=n("mrSG"),p=n("Eyy1"),_=n("YFKU"),g=n("Kxc7"),S=n("UJLt"),v=n("hkLy"),C=n("TsgZ"),O=n("uOxu"),j=n("8woN"),L=Object(O.getLogger)("Platform.Model.Watchlist"),(w={}).red=Object(_.t)("Red list"),w.green=Object(_.t)("Green list"),w.orange=Object(_.t)("Orange list"),w.purple=Object(_.t)("Purple list"),w.blue=Object(_.t)("Blue list"),N=w},"p+vD":function(t,e,n){"use strict";function o(t){var e=Object(_.__assign)({},t);return e.title=e.name,delete e.name,Object(_.__assign)(Object(_.__assign)({},e),{id:"colored"===e.type?Object(g.ensureNotNull)(e.color):e.id,isHotlist:!1})}function r(t){return t.ok?t.json():t.json().then(function(t){throw new Error(t.detail||"not ok")})}function s(){return Object(S.fetch)("/api/v1/symbols_list/all/",{credentials:"include"}).then(r).then(function(t){return t.filter(function(t){return t.symbols.length>0})}).then(function(t){return t.map(o)})}function i(){return Object(S.fetch)("/api/v1/symbols_list/colored/",{credentials:"same-origin"}).then(r).then(function(t){return t.map(o)})}function a(){return Object(S.fetch)("/api/v1/symbols_list/custom/",{credentials:"same-origin"}).then(r).then(function(t){return t.map(o)})}function u(t){return Object(S.fetch)("/api/v1/symbols_list/"+t.type+"/"+t.id+"/",{credentials:"same-origin"}).then(r)}function l(t,e){return Object(S.fetch)("/api/v1/symbols_list/"+t.type+"/"+t.id+"/rename/",{method:"PATCH",credentials:"same-origin",body:JSON.stringify({name:e}),headers:{"Content-Type":"application/json"}}).then(r)}function c(t){return Object(S.fetch)("/api/v1/symbols_list/"+t.type+"/"+t.id+"/",{method:"DELETE",credentials:"same-origin"})}function f(t,e){return Object(S.fetch)("/api/v1/symbols_list/"+t.type+"/"+t.id+"/append/",{method:"PATCH",credentials:"same-origin",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then(r)}function h(t,e){return Object(S.fetch)("/api/v1/symbols_list/"+t.type+"/"+t.id+"/remove/",{method:"PATCH",credentials:"same-origin",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then(r)}function d(t,e){return 0===e.length&&"colored"===t.type?c(t):Object(S.fetch)("/api/v1/symbols_list/"+t.type+"/"+t.id+"/replace/?unsafe=true",{method:"PATCH",credentials:"same-origin",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then(r)}function m(t){var e=Object(_.__assign)(Object(_.__assign)({},t),{name:t.title});return delete e.title,Object(S.fetch)("/api/v1/symbols_list/custom/",{method:"POST",credentials:"same-origin",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then(r).then(o)}function b(t){Object(v.saveTextFile)(t.title+".txt",t.symbols.join(","))}function y(t){return Object(S.fetch)("/api/v1/symbols_list/active/"+t+"/",{method:"POST",credentials:"same-origin"})}function p(){return Object(S.fetch)("/api/v1/symbols_list/active/",{method:"GET",credentials:"same-origin"}).then(r).then(o)}var _,g,S,v;n.r(e),
n.d(e,"getAllWatchLists",function(){return s}),n.d(e,"getColoredWatchLists",function(){return i}),n.d(e,"getCustomWatchLists",function(){return a}),n.d(e,"getSymbols",function(){return u}),n.d(e,"renameWatchList",function(){return l}),n.d(e,"removeWatchList",function(){return c}),n.d(e,"addSymbols",function(){return f}),n.d(e,"removeSymbols",function(){return h}),n.d(e,"replaceSymbols",function(){return d}),n.d(e,"createWatchList",function(){return m}),n.d(e,"exportList",function(){return b}),n.d(e,"setActive",function(){return y}),n.d(e,"getActive",function(){return p}),_=n("mrSG"),g=n("Eyy1"),S=n("BHQF"),v=n("AXL+")},tEuG:function(t,e,n){"use strict";function o(){return null===_&&(_=new m),_}var r,s,i,a,u,l,c,f,h,d,m,b,y,p,_,g=n("YFKU"),S=n("mrSG"),v=n("Eyy1"),C=n("BHQF"),O=n("p+vD"),j=n("uOxu"),w=Object(j.getLogger)("MarkedSymbols.Api"),L=function(){function t(){}return t.prototype.getColoredLists=function(){return Object(O.getColoredWatchLists)()},t.prototype.removeSymbols=function(t,e){return 0===e.length?Promise.resolve():(w.logNormal("Sending request to remove symbols from "+t+"-list: "+e),Object(C.fetch)("/api/v1/symbols_list/colored/"+t+"/remove/",{method:"PATCH",credentials:"same-origin",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}))},t.prototype.addSymbols=function(t,e){return 0===e.length?Promise.resolve():(w.logNormal("Sending request to add/move symbols to "+t+"-list: "+e),Object(C.fetch)("/api/v1/symbols_list/colored/"+t+"/append/",{method:"PATCH",credentials:"same-origin",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}))},t}(),N=n("FBuY"),A=n("TxTq"),D=n.n(A),P=n("PfBM"),E=n("dm8g"),T=(n("iKPL"),n("J/x9")),H=n("9oVN"),M=n("ehHn"),F=n("IWXC"),q=500;r=Object(j.getLogger)("MarkedSymbols.Model"),s="ListChanged",i="marked-symbols",a=["red","blue","green","orange","purple"],u=null,c=function(){function t(t){var e=this;this._promise=Object(T.a)(),this._service=null,this._symbols=new Map,this._changed=new Set,this._diff=new Map,this._names={},this._onCrossTabChange=function(t){r.logNormal("Cross tab sync"),JSON.parse(t).forEach(function(t){e._setSymbolColor(t.name,t.color)}),e._onListChange(!0)},this._onPushStreamChange=function(t){window.user&&window.user.session_hash!==t&&(r.logNormal("Cross browser sync"),e.syncSymbols())},this._onPushStreamStatus=function(t){t===P.ConnectionStatus.Open&&u===P.ConnectionStatus.Closed?(window.is_authenticated&&(l=setTimeout(function(){r.logNormal("Reconnect sync"),e.syncSymbols()},30*Math.random()*1e3+3e4)),u=t):t===P.ConnectionStatus.Closed&&(u=t,clearTimeout(l))},this._opts=t,this._api=t.api||new L,this._session=t.quoteSession||Object(F.getQuoteSessionInstance)("simple"),this._promise.then(function(t){return e._service=t}),this.connect()}return t.prototype.getSymbolsByColor=function(t){var e,n;return null===this._service?[]:(e=this._service.store.getState(),(n=Object(H.k)(e,t))?n.symbols:[])},t.prototype.getLists=function(){var t=this;return a.reduce(function(e,n){return e.set(n,new Set(t.getSymbolsByColor(n))),e},new Map)},
t.prototype.setSymbolsColor=function(t,e){var n=this;r.logNormal("Set symbols color "+e);try{t.forEach(function(t){n._setSymbolColor(t,e)})}finally{this._onListChange()}},t.prototype.getSymbolColor=function(t){var e=this._symbols.get(t);return e?e.color:null},t.prototype.clearAllSymbolsColor=function(){r.logNormal("Clear all symbols color");var t=Array.from(this._symbols.keys());this.setSymbolsColor(t,null),this._clearStore()},t.prototype.syncSymbols=function(){var t=this;return Promise.all([this._api.getColoredLists(),this._promise]).then(function(e){var n=e[0];return t._ensureConsistency(n)}).then(function(e){var n,o,s,i,a,u,l,c,f;for(t._names={},n=[],o=function(e){e.color&&e.title&&(t._names[e.color]=e.title),n.push.apply(n,e.symbols.map(function(t){return{name:t,color:e.color,serverColor:e.color}}))},s=0,i=e;s<i.length;s++)o(i[s]);u=(a=Object(v.ensureNotNull)(t._service)).store,l=a.actions,c=e.filter(function(t){return 0===t.symbols.length}).map(function(t){return Object(S.__assign)(Object(S.__assign)({},t),{symbols:[]})}),u.dispatch(l.setSymbolLists(c)),r.logNormal("Sync symbols"),f=new Set(t._symbols.keys()),n.forEach(function(e){var n=t._symbols.get(e.name)||null,o=n&&n.color!==e.color,r=null===n&&e.color;(o||r)&&t._onChange(e,n,!1),f.delete(e.name)}),f.forEach(function(e){var n=t._symbols.get(e),o=n&&null!==n.color;o&&t._onChange({name:e,color:null,serverColor:null},n,!1)}),t._onListChange(!0)}).catch(function(t){throw r.logError("Sync symbols error: "+t.message),t})},t.prototype.flushChanges=function(){var t,e,n,o,s,i,a=this,u=this._getChangedSymbols();for(this._changed.clear(),t=u.length>0?this._handleSymbols(u):Promise.resolve([]),e=0,n=Array.from(this._symbols.entries());e<n.length;e++)s=(o=n[e])[0],i=o[1],this._symbols.set(s,{name:i.name,color:i.color,serverColor:i.color});return t.then(function(t){return r.logNormal("Flush changes"),t}).catch(function(t){return r.logError("Flush changes error: "+t.message),Object(E.syncUserData)("marked-symbols"),a.syncSymbols(),[]})},t.prototype.clear=function(){this._symbols.clear(),this._clearStore(),r.logNormal("Clear")},t.prototype.connect=function(){this._subscribeOnCrossTabEvent(),this._subscribeOnPushStream()},t.prototype.closeConnection=function(){this._unsubscribeOnCrossTabEvent(),this._unsubscribeOnPushStream()},t.prototype._ensureConsistency=function(t){var e,n,o,s,i,u,l,c,f,h,d,m,b,y,p,_,g,S,C,O=this;for(t=t.filter(function(t){return null!==t.color}).sort(function(t,e){var n=a.indexOf(Object(v.ensureNotNull)(t.color)),o=a.indexOf(Object(v.ensureNotNull)(e.color));return n-o}),e=function(){var e,n,o,r,s=new Map;for(e=0,n=t;e<n.length;e++)o=n[e],r=Object(v.ensureNotNull)(o.color),s.set(r,new Set(o.symbols));return s}(),n=new Set,o=new Map,s=new Map,i=function(t,e){return t.has(e)||t.set(e,new Set),Object(v.ensureDefined)(t.get(e))},u=0,l=Array.from(e.entries());u<l.length;u++)for(f=(c=l[u])[0],h=c[1],d=0,m=Array.from(h);d<m.length;d++)b=m[d],n.has(b)&&(i(o,f).add(b),h.delete(b)),Object(M.k)(b)===b&&i(s,f).add(b),n.add(b);for(y=function(t,e,n){return n?{
color:t,before:e,after:n.pro_name||e}:{color:t,before:e,after:e}},p=[],_=function(t,e){if(0===e.size)return"continue";r.logNormal("Marked consistency: resolving suspicious symbols in "+t+" list - "+Array.from(e)),p.push(Promise.all(Array.from(e).map(function(e){return O._session.snapshot(e).then(function(n){return y(t,e,n)}).catch(function(){return y(t,e)})})))},g=0,S=Array.from(s.entries());g<S.length;g++)_(f=(C=S[g])[0],C[1]);return Promise.all(p).then(function(s){var a,u,l,c,f,h,d,m,b,y,p,_,g,S,v,C,j,w,L,N=new Map;for(a=0,u=s;a<u.length;a++)for(l=0,c=u[a];l<c.length;l++)(f=c[l]).after!==f.before&&((h=i(e,f.color)).delete(f.before),i(o,f.color).add(f.before),n.has(f.after)||(n.add(f.after),h.add(f.after),i(N,f.color).add(f.after)));for(0!==o.size&&r.logNormal("Marked consistency: removing symbols from "+o.size+" lists"),d=0,m=Array.from(o.entries());d<m.length;d++)y=(b=m[d])[0],p=b[1],O._api.removeSymbols(y,Array.from(p));for(0!==N.size&&r.logNormal("Marked consistency: appending resolved symbols to "+o.size+" lists"),_=0,g=Array.from(N.entries());_<g.length;_++)y=(S=g[_])[0],v=S[1],O._api.addSymbols(y,Array.from(v));for(C=function(e,n){var o=t.find(function(t){return t.color===e});o&&(o.symbols=Array.from(n))},j=0,w=Array.from(e.entries());j<w.length;j++)C(y=(L=w[j])[0],p=L[1]);return t})},t.prototype._handleSymbols=function(t){var e,n,o,r,s,i,a,u,l,c,f,h,d=new Map,m=new Map,b=function(t,e){return t.has(e)||t.set(e,new Set),Object(v.ensureDefined)(t.get(e))};for(e=0,n=t;e<n.length;e++)(o=n[e]).color?b(d,o.color).add(o.name):o.serverColor&&b(m,o.serverColor).add(o.name);for(r=[],s=0,i=Array.from(d.entries());s<i.length;s++)u=(a=i[s])[0],l=a[1],r.push(this._api.addSymbols(u,Array.from(l)));for(c=0,f=Array.from(m.entries());c<f.length;c++)u=(h=f[c])[0],l=h[1],r.push(this._api.removeSymbols(u,Array.from(l)));return Promise.all(r)},t.prototype._setSymbolColor=function(t,e){var n=this._symbols.get(t)||null,o={name:t,color:e,serverColor:n?n.serverColor:null},r=n&&n.color!==o.color,s=!n&&o.color;(r||s)&&this._onChange(o,n,!0)},t.prototype._onChange=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!0),this._addSymbolToList(t.name,t.color,e&&e.color),this._collectDiffByColor(t.name,t.color,e&&e.color),this._symbols.set(t.name,t),n&&this._changed.add(t.name),this._opts.onSymbolChange&&this._opts.onSymbolChange({name:t.name,color:t.color},e?{name:e.name,color:e.color}:null)},t.prototype._onListChange=function(t){void 0===t&&(t=!1),this._diff.size&&(this._opts.onListChange&&this._opts.onListChange(this._diff),t||N.TVXWindowEvents.emit(s,JSON.stringify(this._getChangedSymbols())),this._diff.clear())},t.prototype._addSymbolToList=function(t,e,n){var o,s,i,a,u;if(null!==this._service){if(s=(o=this._service).store,i=o.actions,e){if((a=new Set(this.getSymbolsByColor(e))).has(t))return;if(a.size===q)throw r.logNormal("LimitReached"),new Error("LimitReached");a.add(t),u=this._ensureColoredList(e),s.dispatch(i.addOrUpdateSymbolList(Object(S.__assign)(Object(S.__assign)({},u),{symbols:Array.from(a)})))}
n&&((a=new Set(this.getSymbolsByColor(n))).delete(t),u=this._ensureColoredList(n),s.dispatch(i.addOrUpdateSymbolList(Object(S.__assign)(Object(S.__assign)({},u),{symbols:Array.from(a)}))))}},t.prototype._ensureColoredList=function(t){var e=Object(v.ensureNotNull)(this._service).store,n=e.getState();return Object(H.k)(n,t)||Object(M.c)(t,this._names[t])},t.prototype._collectDiffByColor=function(t,e,n){var o,r;e!==n&&(e&&((o=this._diff.get(e))?o.set(t,1):((r=new Map).set(t,1),this._diff.set(e,r))),n&&((o=this._diff.get(n))?o.set(t,-1):((r=new Map).set(t,-1),this._diff.set(n,r))))},t.prototype._getChangedSymbols=function(){var t=this,e=[];return this._changed.forEach(function(n){var o=t._symbols.get(n);o&&e.push(o)}),e},t.prototype._clearStore=function(){var t,e,n,o,r;null!==this._service&&(e=(t=this._service).store,n=t.actions,o=e.getState(),r=a.map(function(t){return Object(H.k)(o,t)}).filter(function(t){return Boolean(t)}).map(function(t){return Object(S.__assign)(Object(S.__assign)({},t),{symbols:[]})}),e.dispatch(n.setSymbolLists(r)))},t.prototype._subscribeOnCrossTabEvent=function(){N.TVXWindowEvents.on(s,this._onCrossTabChange)},t.prototype._unsubscribeOnCrossTabEvent=function(){N.TVXWindowEvents.off(s,this._onCrossTabChange)},t.prototype._subscribeOnPushStream=function(){D.a.on(i,this._onPushStreamChange),D.a.onPrivateStatus(this._onPushStreamStatus)},t.prototype._unsubscribeOnPushStream=function(){D.a.off(i,this._onPushStreamChange),D.a.offStatus(this._onPushStreamStatus),clearTimeout(l),u=null},t}(),f=n("JOqt"),h=n("brCa"),n.d(e,"a",function(){return o}),d=2e3,m=function(){function t(t){var e=this;this._symbolChangeHandlers=new Map,this._listChangeHandlers=[],this._initHandlers=[],this._sync=null,this._inited=!1,this._broadcastOnSymbolChange=function(t,n){var o=e._symbolChangeHandlers.get(t.name);o&&o.forEach(function(e){return e(t,n)})},this._broadcastOnListChange=function(t){e._listChangeHandlers.forEach(function(e){return e(t)})},this._flushModelChanges=function(){e._model.flushChanges()},this._onLoginStateChange=function(){var t;e._model.closeConnection(),window.is_authenticated?(e._model.connect(),t=e._syncSymbols()):(e._model.clear(),e._inited=!1,t=Promise.resolve()),t.then(e._fireInit)},this._fireInit=function(){e._initHandlers.forEach(function(t){return t()})},this._runWithSync=function(t){e._sync?e._sync.then(t):t()},this._model=new c({api:t?t.api:void 0,quoteSession:t?t.quoteSession:void 0,onSymbolChange:this._broadcastOnSymbolChange,onListChange:this._broadcastOnListChange}),this._subscribeLoginStateChange(),this._flushModelChanges=Object(f.debounce)(this._flushModelChanges,d),this._syncSymbols().then(this._fireInit)}return t.prototype.getSymbolsByColor=function(t){return this._model.getSymbolsByColor(t)},t.prototype.setSymbolsColor=function(t,e){var n=this;0!==t.length&&this._runWithSync(function(){try{n._model.setSymbolsColor(t,e),n._flushModelChanges()}catch(t){"LimitReached"===t.message&&(n._flushModelChanges(),p||(p=Object(h.createNoticeDialog)({title:y,content:b(q)})).then(function(t){
t.on("afterClose",function(){p=null}),t.open()}))}})},t.prototype.getSymbolColor=function(t){return this._model.getSymbolColor(t)},t.prototype.clearAllSymbolsColor=function(){var t=this;this._runWithSync(function(){t._model.clearAllSymbolsColor(),t._flushModelChanges()})},t.prototype.mergeSymbolsByColor=function(t,e){var n=this._model.getSymbolsByColor(t),o=n.filter(function(t){return!e.includes(t)}),r=e.filter(function(t){return!n.includes(t)});this.setSymbolsColor(o,null),this.setSymbolsColor(r,t)},t.prototype.onSymbolChange=function(t,e){var n=this._symbolChangeHandlers.get(t);n?n.push(e):this._symbolChangeHandlers.set(t,[e])},t.prototype.offSymbolChange=function(t,e){var n,o=this._symbolChangeHandlers.get(t);o&&((n=o.filter(function(t){return t!==e})).length>0?this._symbolChangeHandlers.set(t,n):this._symbolChangeHandlers.delete(t))},t.prototype.onListChange=function(t){this._listChangeHandlers.push(t)},t.prototype.offListChange=function(t){this._listChangeHandlers=this._listChangeHandlers.filter(function(e){return e!==t})},t.prototype.onInit=function(t){this._initHandlers.push(t)},t.prototype.offInit=function(t){this._initHandlers=this._initHandlers.filter(function(e){return e!==t})},t.prototype.destroy=function(){this._model.clear(),this._model.closeConnection(),this._unsubscribeLoginStateChange()},t.prototype.isInited=function(){return this._inited},t.prototype._subscribeLoginStateChange=function(){window.loginStateChange&&window.loginStateChange.subscribe(this,this._onLoginStateChange)},t.prototype._unsubscribeLoginStateChange=function(){window.loginStateChange&&window.loginStateChange.unsubscribe(this,this._onLoginStateChange)},t.prototype._syncSymbols=function(){var t,e=this;return window.is_authenticated?(this._sync=this._model.syncSymbols(),t=function(){e._sync=null,e._inited=!0},this._sync.then(t).catch(t)):Promise.resolve()},t}(),b=function(t){return g.t("Unable to flag all selected symbols since it exceeds the maximum amount ({0}).").format(t)},y=g.t("Issue With Flagging"),p=null,_=null}}]);